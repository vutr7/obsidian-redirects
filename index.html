<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Obsidian Redirect</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 2rem; }
    #fallback, #unknown { display: none; }
  </style>
  <script>
    function tryRedirect(uri) {
      try { window.location.href = uri; } catch(e) {}
      setTimeout(() => { try { window.location.assign(uri); } catch(e) {} }, 30);
      setTimeout(() => { try { window.location.replace(uri); } catch(e) {} }, 60);
      setTimeout(() => {
        const a = document.createElement('a');
        a.href = uri;
        a.style.display = 'none';
        document.body.appendChild(a);
        try { a.click(); } catch(e) {}
      }, 90);
      setTimeout(() => {
        const ifr = document.createElement('iframe');
        ifr.style.display = 'none';
        ifr.src = uri;
        document.body.appendChild(ifr);
      }, 120);
      // Fallback sichtbar machen
      setTimeout(() => {
        const fb = document.getElementById("fallback");
        const link = document.getElementById("link");
        link.href = uri;
        fb.style.display = "block";
      }, 1500);
      // Tab nach 2s automatisch schließen
      setTimeout(() => {
        window.close();
      }, 2000);
    }

    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const t = params.get("t");

      const redirects = {
        // bestehend
        tagesnotiz: "obsidian://advanced-uri?vault=MINH%20TRUNG%20VU&daily=true",
        erfolge: "obsidian://advanced-uri?vault=MINH%20TRUNG%20VU&filepath=04%20Journal/Erfolge.md",
        optimierung: "obsidian://quickadd?choice=Optimierung",

        // neu: Periodic Notes via Advanced URI (erstellt bei Bedarf)
        weekly:    "obsidian://adv-uri?vault=MINH%20TRUNG%20VU&commandid=periodic-notes%3Aopen-weekly-note",
        monthly:   "obsidian://adv-uri?vault=MINH%20TRUNG%20VU&commandid=periodic-notes%3Aopen-monthly-note",
        quarterly: "obsidian://adv-uri?vault=MINH%20TRUNG%20VU&commandid=periodic-notes%3Aopen-quarterly-note",
        yearly:    "obsidian://adv-uri?vault=MINH%20TRUNG%20VU&commandid=periodic-notes%3Aopen-yearly-note"
      };

      const target = redirects[t];
      if (!target) {
        document.getElementById('unknown').style.display = 'block';
        return;
      }
      tryRedirect(target);
    });
  </script>
</head>
<body>
  <h1>Redirect läuft …</h1>
  <p id="fallback">
    Falls Obsidian nicht automatisch startet, bitte
    <a id="link" href="#">hier klicken</a>.
  </p>
  <p id="unknown"><strong>Kein Redirect gefunden.</strong> Beispiele: <code>?t=weekly</code>, <code>?t=monthly</code>, <code>?t=quarterly</code>, <code>?t=yearly</code></p>
</body>
</html>
